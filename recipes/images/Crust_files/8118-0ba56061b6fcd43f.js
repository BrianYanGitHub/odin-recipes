(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8118],{48118:function(e,r,t){"use strict";t.d(r,{QUERY_KEY_GET_PLP_SEARCH_V1:function(){return ye},preloadPlpSearchV1Query:function(){return Oe},usePlpSearchV1QueryVariables:function(){return ve},usePlpSearchV1QueryWithVariables:function(){return me}});t(40316);var a=t(59499),o=t(41609),n=t.n(o),i=t(96012),s=t(84601),c=t(64595),l=t(67294),u=t(11163),d=t(41982),p=t(32790),_=t(1344),f=t(13338),y=t(20195),b=t(22026),v=t(1811),h=t(18136),m=t(17469),O=t(28825),P=t(26098),g=t(74965),j=t(50794);const w=e=>{if(!e.asPath)return;const r=(0,P.EG)(e.asPath),t=(0,P.jI)(e.query,"category"),a=(0,j.Yq)(e.asPath),o=(0,j.$L)(e.asPath),n=(0,j.O_)(e.asPath),i=(0,P.jI)(e.query,"auto_recover"),s="true"===(0,P.jI)(e.query,"facetRecovery")||void 0,c=(0,j.PC)(e),l=(0,P.lW)(e.query),u=(0,P.jI)(e.query,"kwr"),d=(0,P.jI)(e.query,"marketing_id"),p=(0,P.jI)(e.query,"maxPrice"),_=(0,P.jI)(e.query,"minPrice"),f=(0,P.jI)(e.query,"Nao"),y=(0,g.ew)(e.asPath),b=(0,P.jI)(e.query,"sortBy"),v="true"===(0,P.jI)(e.query,"splchkoff")||void 0,h=(0,P.jI)(e.query,"storeIdList");return{auto_recover:i,brand:a,brand_id:o,category:null!==t&&void 0!==t?t:o?void 0:r,facet_recovery:s,faceted_value:c,keyword:l,kwr:u,marketing_id:d,max_price:p,min_price:_,offset:Number.parseInt(null!==f&&void 0!==f?f:"",10)||0,page:y,promo_id:n,sort_by:b,splchkoff:v,store_ids:h}};var S=t(40554),k=t.n(S);const E=/^\d{3}[ -]\d{2}[ -]\d{4}$/,D=(e,r)=>e&&(!r||!(e=>{const r=e.trim().length;return k()(e)>0&&r>4&&r<11})(r)&&!(e=>E.test(e))(r));var q=t(64e3),I=t(48113),R=t(76291),A=t(88141),C=t(92354),V=t(2097),T=t(6432),G=t(10341);function L(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function Z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?L(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const x=e=>{let{name:r,endpointPathKey:t,importQuerySource:a,firstCallVariables:o,transform:n}=e;return{name:r,defaultOptions:{staleTime:9e5,cacheTime:9e5,keepPreviousData:!0},keyFn:e=>{var t;return[r,Z(Z({},e),{},{offset:null===e||void 0===e||null===(t=e.offset)||void 0===t?void 0:t.toString()})]},queryFn:async e=>{var r;o.value||(o.value=e);const{apiKey:s,baseUrl:c,apis:{product:{endpointPaths:l}}}=(0,i.asConfigV2)(i.config).services.redskyAggregations,u=l&&t in l?l[t]:null;if(!u)throw new Error("path not defined for ".concat(t," query"));const d=await(0,R.W)(),{auto_recover:_,brand:f,brand_id:y,category:b,default_purchasability_filter:v,facet_recovery:h,faceted_value:m,include_sponsored:O,keyword:P,kwr:g,marketing_id:j,max_price:w,member_id:S,min_price:k,offset:E,page:D,pricing_store_id:L=p.AP,promo_id:Z,scheduled_delivery_store_id:x,sort_by:Q,splchkoff:B,store_ids:K,zip:N}=null!==e&&void 0!==e?e:{};if(E&&E>=1500)throw new Error("Offset too high for ".concat(t," query"));const M=(0,V.WE)(),W=null!==(r=(0,I.ej)(q.$6))&&void 0!==r?r:"0",H={key:s,effective_date:d,auto_recover:_,brand:f,brand_id:y,category:b&&!b.includes("|")?b:void 0,channel:"WEB",count:24,default_purchasability_filter:v,facet_recovery:h,faceted_value:m,include_sponsored:O,keyword:P,kwr:g,marketing_id:j,max_price:w,member_id:S,min_price:null!==k&&void 0!==k?k:w?"0":void 0,offset:E,page:D,platform:(0,T.o$)(),pricing_store_id:L,promo_id:Z,scheduled_delivery_store_id:x,sort_by:Q,splchkoff:B,store_ids:K,useragent:M,visitor_id:W,zip:N},Y=C.Z.buildURLWithParams(u,H,c),{data:F,ok:z,statusText:$}=await(0,A.G)(Y,{errorTag:G.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_API_ERROR,partialErrorTag:G.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_PARTIAL_API_ERROR,timerTag:G.sO.REDSKY_AGGREGATIONS_PLP_SEARCH_API_CALL,importQuerySource:a});if(z){const e=null===F||void 0===F?void 0:F.data;return n&&e?n(e):e}throw new Error("".concat($))}}};function Q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function B(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Q(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const K=e=>function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{variables:a,enabled:o}=ve(t);return e(B(B({},a),r),{enabled:!1!==t.enabled&&o})};function N(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function M(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?N(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const W=(e,r)=>async t=>{const a=M(M({},w(t)),{},{default_purchasability_filter:"false",pricing_store_id:p.AP}),o=await t.preloadInitialQuery(e,a),n=r(null===o||void 0===o?void 0:o.data);var i,s;n&&(null===(i=t.res)||void 0===i||i.writeHead(302,{Location:n}),null===(s=t.res)||void 0===s||s.end());return{}},H="@web/domain-product/get-plp-search-v2",{useQuery:Y}=(0,c.J)(x({name:H,endpointPathKey:"plpSearchV2",firstCallVariables:{},importQuerySource:()=>t.e(8408).then(t.t.bind(t,15225,17))}));K(Y),W(Y,(e=>{var r,t,a;return null===e||void 0===e||null===(r=e.search)||void 0===r||null===(t=r.search_response)||void 0===t||null===(a=t.metadata)||void 0===a?void 0:a.redirect_deeplink}));var F=t(4730),z=t(57557),$=t.n(z);const J=["facet_id"],U=["id"],X=["values"],ee=["id"],re=["id","canonical_name","source","image_url"],te=["redirect_deeplink"],ae=["search_response"];function oe(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function ne(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?oe(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):oe(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const ie=e=>{var r,t;return null!==e&&void 0!==e&&null!==(r=e.search)&&void 0!==r&&null!==(t=r.search_response)&&void 0!==t&&t.bread_box_list?{bread_box_list:e.search.search_response.bread_box_list.map((e=>{var r;let{facet_id:t}=e,a=(0,F.Z)(e,J);return ne({facet:t,values:null===(r=a.values)||void 0===r?void 0:r.map((e=>{let{id:r}=e;return ne({facet_id:r},(0,F.Z)(e,U))}))},a)}))}:{}},se=e=>{var r,t;return null!==e&&void 0!==e&&null!==(r=e.search)&&void 0!==r&&null!==(t=r.search_response)&&void 0!==t&&t.bread_crumb_list?{bread_crumb_list:e.search.search_response.bread_crumb_list.map((e=>{let{values:r}=e;return ne({bread_crumb_values:r},(0,F.Z)(e,X))}))}:{}},ce=e=>{var r,t;return null!==e&&void 0!==e&&null!==(r=e.search)&&void 0!==r&&null!==(t=r.search_response)&&void 0!==t&&t.facet_list?{facet_list:e.search.search_response.facet_list.map((e=>ne(ne({name:e.facet_id},e.options?{details:e.options.map((e=>{let{id:r}=e;return ne(ne({facet_id:r},(0,F.Z)(e,ee)),{},{__typename:"SearchFacetDetails"})}))}:{}),e)))}:{}},le=e=>{var r,t;return null!==e&&void 0!==e&&null!==(r=e.search)&&void 0!==r&&null!==(t=r.search_response)&&void 0!==t&&t.visual_facet_list?{visual_facet_list:e.search.search_response.visual_facet_list.map((e=>ne(ne({name:e.facet_id},e.options?{details:e.options.map((e=>{let{id:r,canonical_name:t,source:a,image_url:o}=e;return ne(ne({facet_canonical:t,facet_id:r,facet_source:a,label_image_url:o},(0,F.Z)(e,re)),{},{__typename:"SearchVisualFacetDetails"})}))}:{}),e)))}:{}},ue=e=>{var r,t;if(null===e||void 0===e||null===(r=e.search)||void 0===r||null===(t=r.search_response)||void 0===t||!t.metadata)return{};const a=e.search.search_response.metadata,{redirect_deeplink:o}=a;return{typed_metadata:ne(ne({deep_link:o},(0,F.Z)(a,te)),{},{__typename:"SearchTypedMetadata"})}},de=e=>{var r,t;if(null===e||void 0===e||null===(r=e.search)||void 0===r||null===(t=r.search_response)||void 0===t||!t.search_buckets)return{};const{nearby_stores:a=[],related_items:o=[],term_drop:n=[]}=e.search.search_response.search_buckets;return{buckets:[...a.map((e=>({__typename:"SearchOldBucket",typed_metadata:{__typename:"SearchBucketTypedMetadata",bucket_type:"nearbyStores",seeall:e.expand,related_items_query:e.query},products:e.products}))),...o.map((e=>({__typename:"SearchOldBucket",typed_metadata:{__typename:"SearchBucketTypedMetadata",bucket_type:"relatedItems",keyword:"relatedresults",seeall:e.expand,related_items_query:e.query},products:e.products}))),...n.map((e=>({__typename:"SearchOldBucket",typed_metadata:{__typename:"SearchBucketTypedMetadata",bucket_type:"termDrop",seeall:e.expand,keyword:e.display_name,display_name:e.display_name,feature_label:e.feature_label,related_items_query:e.query},products:e.products})))]}};function pe(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function _e(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?pe(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const fe=new Set(["scheduled_delivery_store_id"]),ye="@web/domain-product/get-plp-search-v1",be={},ve=function(){var e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{shouldNotWaitForCorrectVariablesOnHardRoute:t}=r,a=(0,u.useRouter)(),o=(0,l.useMemo)((()=>w(a)),[a]),{guestLocation:i,queryState:c}=(0,f.N)(),{zipCode:m}=null!==i&&void 0!==i?i:{},{preferredStoreId:P,queryState:g}=(0,y.lo)(),j=null!==P&&void 0!==P?P:p.AP,{store_ids:S,enabled:k}=(0,h.P)(),E=D(Boolean(S),null===o||void 0===o?void 0:o.keyword),q=E?S:void 0,{scheduledDeliveryStoreId:I,queryState:R}=(0,b.G3)(),A=(0,d.Pd)(),C=(0,d.bC)(),V=!1,T=Boolean(null===o||void 0===o||null===(e=o.faceted_value)||void 0===e?void 0:e.includes(O.lL)),{include_sponsored:G,enabled:L}=(0,_.f)(),Z=A&&L&&k&&(g.status===s.o.Success||g.status===s.o.Error)&&(c.status===s.o.Success||c.status===s.o.Error),x=V||Z&&(!T||(R.status===s.o.Success||R.status===s.o.Error)),Q=V||Z&&(R.status===s.o.Success||R.status===s.o.Error),B=(0,l.useMemo)((()=>_e(_e({},o),{},{default_purchasability_filter:null===E||void 0===E?void 0:E.toString(),include_sponsored:!!G||void 0,member_id:C,pricing_store_id:j,scheduled_delivery_store_id:I,store_ids:q,zip:m})),[o,E,G,C,j,I,q,m]),K=n()(be.value)?[]:Object.entries(B).filter((e=>{var r;let[t,a]=e;return a!==(null===(r=be.value)||void 0===r?void 0:r[t])})).map((e=>{let[r]=e;return r})),N=K.some((e=>!fe.has(e))),M=(0,v.A)(),W=t&&!M,H=be.value&&W&&!N?be.value:B,Y=(0,l.useMemo)((()=>({variables:W?H:B,enabled:W?x:Q})),[W,H,x,B,Q]);return Y},{useQuery:he}=(0,i.flags)(m.Cr)?(0,c.J)(x({name:"".concat(H,"-compat"),endpointPathKey:"plpSearchV2",firstCallVariables:be,importQuerySource:()=>t.e(8408).then(t.t.bind(t,15225,17)),transform:e=>{if(!e)return;const{search:{search_response:r={}}={}}=e;return{search:ne(ne({},(0,F.Z)(e.search,ae)),{},{search_response:ne(ne(ne(ne(ne(ne(ne({},ie(e)),se(e)),ce(e)),le(e)),ue(e)),de(e)),$()(r,["bread_box_list","bread_crumb_list","facet_list","visual_facet_list","metadata","search_buckets"]))})}}})):(0,c.J)(x({name:ye,endpointPathKey:"plpSearchV1",firstCallVariables:be,importQuerySource:()=>t.e(6108).then(t.t.bind(t,91698,17))})),me=K(he),Oe=W(he,(e=>{var r,t,a;return null===e||void 0===e||null===(r=e.search)||void 0===r||null===(t=r.search_response)||void 0===t||null===(a=t.typed_metadata)||void 0===a?void 0:a.redirect_url}))},40316:function(){}}]);